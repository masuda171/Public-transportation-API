# 駅すぱあと ルート計算ツール

駅すぱあと Web Service API を使って、複数の座標ペアの **距離・所要時間・費用** を一括計算するNext.js Webアプリです。
計算結果のCSV出力に加え、**ルート地図表示**と**交通手段ごとの経路詳細**も確認できます。

## セットアップ

```bash
# 1. プロジェクトフォルダに移動
cd zidousya-main

# 2. パッケージインストール
npm install

# 3. 開発サーバー起動
npm run dev
```

ブラウザで http://localhost:3000 を開いてください。

## 使い方

1. **駅すぱあと API キー**を入力（[駅すぱあと Web Service](https://developer.ekispert.com/) で取得）
2. **CSVをアップロード**（「テンプレートDL」ボタンで雛形を取得できます）
3. **「ルートを計算する」**をクリック
4. 結果テーブル・地図・経路詳細が表示されます
5. **「CSV出力」**で結果をダウンロード

## 入力CSVのフォーマット

| 列名 | 説明 |
|------|------|
| id | 識別子（任意） |
| origin_name | 出発地の名称（任意） |
| origin_lat | 出発地の緯度 |
| origin_lng | 出発地の経度 |
| dest_name | 目的地の名称（任意） |
| dest_lat | 目的地の緯度 |
| dest_lng | 目的地の経度 |

例:
```
id,origin_name,origin_lat,origin_lng,dest_name,dest_lat,dest_lng
1,福岡市役所,33.5902,130.4017,博多駅,33.5903,130.4208
2,佐賀県庁,33.2494,130.2988,佐賀駅,33.2637,130.3009
```

## 出力CSVのフォーマット

| 列名 | 説明 |
|------|------|
| id | 入力の識別子 |
| 出発地名称 | 入力の origin_name（未設定の場合は「未設定」） |
| 目的地名称 | 入力の dest_name（未設定の場合は「未設定」） |
| 距離_km | ルートの総距離（km） |
| 所要時間_分 | 合計所要時間（乗車＋徒歩＋その他、分） |
| 費用_円 | 運賃合計＋料金合計（円） |
| ステータス | 成功 / エラー内容 |
| 出発地緯度 / 出発地経度 | 入力値をそのまま転記 |
| 目的地緯度 / 目的地経度 | 入力値をそのまま転記 |

## 画面機能

### 経路詳細
各ルートの「表示」ボタンを押すと、交通手段ごとの区間が確認できます：

- **交通手段**（徒歩 / 鉄道 / 新幹線 / 有料特急 / バス / 高速バス 等）
- **路線名**
- **区間**（from → to の駅名）

### ルート地図
結果に位置情報が含まれる場合、通過点（駅・地点）をOpenStreetMap上に順番に折れ線で表示します。
※駅すぱあとのレスポンスに含まれる Point の座標を結んだ概略線です（線路・道路形状への完全一致ではありません）。

## API設定仕様

| パラメータ | 値 | 説明 |
|---|---|---|
| `searchType` | `plain` | 平均待ち時間ベースで検索 |
| `sort` | `time` | 所要時間が最短の経路を採用 |
| `answerCount` | `1` | 最良経路を1件取得 |
| `gcs` | `wgs84` | 座標系（WGS84） |

## 技術スタック

- **Next.js 15** (App Router)
- **React 19**
- **駅すぱあと Web Service API**（`/v1/json/search/course/extreme`）
- **Leaflet / react-leaflet** — 地図表示

## ビルド・本番起動

```bash
npm run build
npm run start
```
